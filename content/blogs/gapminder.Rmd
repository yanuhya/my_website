---
categories:
- ""
- ""
date: "2017-10-31T22:26:09-05:00"
description: Lorem Etiam Nullam
draft: false
image: pic09.jpg
keywords: ""
slug: cdc
title: CDC COVID Analysis
---

```{r load-libraries, warning=FALSE, message=FALSE, echo=FALSE}
library(tidyverse)  # Load ggplot2, dplyr, and all the other tidyverse packages
library(gapminder)  # gapminder dataset
library(here)
library(janitor)
library(dplyr)
library(skimr)
```

The [CDC Covid-19 Case Surveillance Data](https://data.cdc.gov/Case-Surveillance/COVID-19-Case-Surveillance-Public-Use-Data/vbim-akqf) is a case surveillance public use dataset with 12 elements for all COVID-19 cases shared with CDC and includes demographics, any exposure history, disease severity indicators and outcomes, presence of any underlying medical conditions and risk behaviors. 


```{r covid_data, echo=FALSE, out.width="100%"}
knitr::include_graphics(here::here("images", "cdc_data.png"), error = FALSE)
```


```{r}
cdc_db <- DBI::dbConnect(
  drv = RSQLite::SQLite(),
  dbname = "cdc_data.db"
)

# browse the tables in the database using DBI::dbListTables()
DBI::dbListTables(cdc_db)

# We can easily set these tables up as database objects using dplyr
cdc_data <- dplyr::tbl(cdc_db, "cdc")

cdc_data
```



There are well over 28 million entries of individual, and we will work with SQLlite database, rather than a CSV file. The two graphs that show death % rate:


1. by age group, sex, and whether the patient had co-morbidities or not


```{r}
query1 <-   cdc_data %>% 
  select(sex, age_group, medcond_yn, death_yn ) %>%
  group_by(sex, age_group, medcond_yn, death_yn) %>%
  summarize(count = n())
  

query1_tibble <- query1 %>% 
  collect()
```

```{r}
query1_tibble1 <- query1_tibble %>%
  na.omit() %>%
  filter(death_yn == "Yes" | death_yn == "No") %>%
  filter(sex == "Female" | sex == "Male" ) %>%
  filter(medcond_yn == "Yes" | medcond_yn == "No") %>%
  filter(age_group != "Missing") %>%
  pivot_wider(names_from = death_yn, values_from = count) %>%
  mutate(death_perc = round((Yes/ (Yes + No)) * 100, 1 )) 
  
```

```{r}
query1_tibble1$medcond_yn[query1_tibble1$medcond_yn == "Yes"] = "With co-morbidity"
query1_tibble1$medcond_yn[query1_tibble1$medcond_yn == "No"] = "Without co-morbidity"
```


```{r}
options(repr.plot.width = 10, repr.plot.height =200 )
ggplot(query1_tibble1, aes(y= age_group, x= death_perc, scales= "free")) +
  geom_col(width = 0.8, fill = "violet") + 
  geom_text(aes(label = death_perc) ,  size = 3,  vjust = 0.5, hjust = -0.2) +
   scale_y_discrete(guide = guide_axis(check.overlap = TRUE)) +
  facet_wrap(~ sex + medcond_yn) +
  NULL
```


1. by age group, sex, and whether the patient was admited to Intensive Care Unit (ICU) or not.
```{r}
query2 <-   cdc_data %>% 
  select(sex, age_group, icu_yn, death_yn ) %>%
  group_by(sex, age_group, icu_yn , death_yn) %>%
  summarize(count = n())
  

query2_tibble <- query2 %>% 
  collect()
```

```{r}
query2_tibble1 <- query2_tibble %>%
  na.omit() %>%
  filter(death_yn == "Yes" | death_yn == "No") %>%
  filter(sex == "Female" | sex == "Male" ) %>%
  filter(icu_yn == "Yes" | icu_yn == "No") %>%
  filter(age_group != "Missing") %>%
  pivot_wider(names_from = death_yn, values_from = count) %>%
  mutate(death_perc = round((Yes/ (Yes + No)) * 100 , 1)) 
  
```

```{r}
query2_tibble1$icu_yn[query2_tibble1$icu_yn == "Yes"] = "ICU Admission"
query2_tibble1$icu_yn[query2_tibble1$icu_yn == "No"] = "No ICU Admission"
```


```{r}
options(repr.plot.width = 10, repr.plot.height =200 )
ggplot(query2_tibble1, aes(y= age_group, x= death_perc, scales= "free")) +
  geom_col(width = 0.8, fill = "orange") + 
  scale_y_discrete(guide = guide_axis(check.overlap = TRUE)) +
  geom_text(aes(label = death_perc) ,size = 3,  vjust = 0.5 , hjust = -0.2) +
  facet_wrap(~ sex + icu_yn)
```